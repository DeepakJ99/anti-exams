<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index file</title>
</head>
<body>
        <input type = "file" name = "imgUploader" multiple>
        <div id = "screenshot">

            <video autoplay></video>
            <img src="">
        <canvas style="display:none;"></canvas>
        <div class="capture-button">Click to start capturing</div>
        <div id = "screenshot-button">Take a screenshot</div>
        </div>
        <button id="btn-submit"> SUBMIT</button>
        <p id = "log" style = "background-color:blue;width:100vw;color:white;font-size:13px"></p>
        <p id = "actResult" style = "background-color:green;width:500px;color:white"></p>
        <p id = "result" style = "background-color:red;width:500px;color:white"></p>
        
</body>
<script src = "jquery.min.js"></script>
<script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
<script>
    document.getElementById('btn-submit').addEventListener('click',()=>{
    const formData = new FormData();
    const input = document.querySelector('input[type="file"]');
    formData.append('imgUploader',input.files[0]);
    const readasurl = function(){
        var reader = new FileReader();
        reader.readAsDataURL(input.files[0]);
        var me = this;
        reader.onload = function(){
            recognize(reader.result)
        } 
    }
    readasurl()
    
    const recognize = function(src){
        Tesseract.recognize(
            src,
            'eng',
            { logger: (m) => {
                document.getElementById('log').innerText+=JSON.stringify(m); }
            }).then(({ data: { text } }) => {
                document.getElementById('actResult').innerText+=text;
            }).catch((e)=>{
                document.getElementById('result').innerText+=e;
            })
    }

    const readLive = function(){
        function hasGetUserMedia() {
  return !!(navigator.mediaDevices &&
    navigator.mediaDevices.getUserMedia);
}

if (hasGetUserMedia()) {
    
    const constraints = {video: true};
function handleError(error) {
  console.error('Error: ', error);
}
const captureVideoButton = document.querySelector('#screenshot .capture-button');
const screenshotButton = document.querySelector('#screenshot-button');
const img = document.querySelector('#screenshot img');
const video = document.querySelector('#screenshot video');

const canvas = document.createElement('canvas');

captureVideoButton.onclick = function() {
  navigator.mediaDevices.getUserMedia(constraints).
    then(handleSuccess).catch(handleError);
};

screenshotButton.onclick = video.onclick = function() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);
  // Other browsers will fall back to image/png
  img.src = canvas.toDataURL('image/webp');
  recognize(canvas.toDataURL('image/webp'));
};

function handleSuccess(stream) {
  screenshotButton.disabled = false;
  video.srcObject = stream;
}
} 

else {
  alert('getUserMedia() is not supported by your browser');
}
    }

    // 
    // fetch('/api/Upload',{
    //     method: 'POST',
    //     body: formData
    // }).then((response)=>response.json()
    // ).then((result)=>{
    //     console.log('Success:',result);
    // }).catch((error)=>{
    //     console.log('Error'  + error);
    // });
});

</script>
</html>
